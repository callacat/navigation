import React, { useState, useEffect } from 'react';
import './App.css'; // ä¿ç•™åŸæœ‰çš„ App.css å¼•å…¥

// å®šä¹‰ä¸»é¢˜æ¨¡å¼çš„é¡ºåº
const themes = ['light', 'dark', 'system'];

// å®šä¹‰ä¸»é¢˜å¯¹åº”çš„å›¾æ ‡å’Œæ–‡æœ¬
const themeIcons = {
  light: { icon: 'â˜€ï¸', text: 'æµ…è‰²æ¨¡å¼' }, // å¤ªé˜³å›¾æ ‡
  dark: { icon: 'ğŸŒ™', text: 'æ·±è‰²æ¨¡å¼' },  // æœˆäº®å›¾æ ‡
  system: { icon: 'âš™ï¸', text: 'è·Ÿéšç³»ç»Ÿ' }, // é½¿è½®å›¾æ ‡
};

function App() {
  // å®šä¹‰ä¸»é¢˜çŠ¶æ€ï¼Œåˆå§‹å€¼ä» localStorage è¯»å–æˆ–é»˜è®¤ä¸º 'system'
  const [theme, setTheme] = useState(() => {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme && themes.includes(savedTheme)) { // ç¡®ä¿è¯»å–çš„ä¸»é¢˜æ˜¯æœ‰æ•ˆçš„
      return savedTheme;
    }
    // å¦‚æœ localStorage ä¸­æ²¡æœ‰æˆ–æ— æ•ˆï¼Œåˆ™æ ¹æ®ç³»ç»Ÿåå¥½è®¾ç½®åˆå§‹ä¸»é¢˜
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark';
    }
    return 'light';
  });

  // ä½¿ç”¨ useEffect æ¥ç›‘å¬ä¸»é¢˜çŠ¶æ€å˜åŒ–å¹¶æ›´æ–° <html> å…ƒç´ çš„ç±»
  useEffect(() => {
    const root = document.documentElement; // è·å– <html> å…ƒç´ 

    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„ dark ç±»ï¼Œé¿å…å†²çª
    root.classList.remove('dark');

    if (theme === 'dark') {
      root.classList.add('dark');
    } else if (theme === 'system') {
      // ç›‘å¬ç³»ç»Ÿä¸»é¢˜å˜åŒ–
      const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
      const handleChange = (e) => {
        if (e.matches) {
          root.classList.add('dark');
        } else {
          root.classList.remove('dark');
        }
      };

      // æ ¹æ®å½“å‰ç³»ç»Ÿä¸»é¢˜è®¾ç½®åˆå§‹ç±»
      if (mediaQuery.matches) {
        root.classList.add('dark');
      } else {
        root.classList.remove('dark');
      }

      // æ·»åŠ ç›‘å¬å™¨
      mediaQuery.addEventListener('change', handleChange);

      // æ¸…ç†å‡½æ•°ï¼šç§»é™¤ç›‘å¬å™¨
      return () => mediaQuery.removeEventListener('change', handleChange);
    }

    // å°†å½“å‰ä¸»é¢˜ä¿å­˜åˆ° localStorage
    localStorage.setItem('theme', theme);

  }, [theme]); // ä¾èµ–é¡¹ä¸º theme çŠ¶æ€ï¼Œåªæœ‰å½“ theme å˜åŒ–æ—¶æ‰é‡æ–°è¿è¡Œ effect

  // å¤„ç†ä¸»é¢˜åˆ‡æ¢çš„å‡½æ•°ï¼šå¾ªç¯åˆ‡æ¢ä¸»é¢˜
  const handleThemeToggle = () => {
    const currentIndex = themes.indexOf(theme);
    const nextIndex = (currentIndex + 1) % themes.length;
    setTheme(themes[nextIndex]);
  };

  // è·å–å½“å‰ä¸»é¢˜å¯¹åº”çš„å›¾æ ‡å’Œæ–‡æœ¬
  const currentThemeInfo = themeIcons[theme];

  return (
    // ä½¿ç”¨ flexbox å¸ƒå±€ï¼Œå°†å†…å®¹å‚ç›´å±…ä¸­ï¼Œå¹¶å°†å³ä¸Šè§’å…ƒç´ é å³å¯¹é½
    <div className="min-h-screen bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 relative flex flex-col items-center justify-center p-4">

      {/* å³ä¸Šè§’åŒºåŸŸ */}
      <div className="absolute top-4 right-4 flex items-center space-x-4">
        {/* ä¸»é¢˜åˆ‡æ¢æŒ‰é’® */}
        <button
          className="w-8 h-8 rounded-full bg-gray-300 dark:bg-gray-700 text-gray-700 dark:text-gray-300 flex items-center justify-center text-lg" // è°ƒæ•´æ–‡æœ¬å¤§å°ä»¥é€‚åº”å›¾æ ‡
          onClick={handleThemeToggle}
          title={`å½“å‰ä¸»é¢˜: ${currentThemeInfo.text}`}
        >
          {currentThemeInfo.icon} {/* ä½¿ç”¨å›¾æ ‡ */}
        </button>

        {/* GitHub é“¾æ¥ï¼Œè¯·æ›¿æ¢ä¸ºä½ çš„ GitHub ä»“åº“åœ°å€ */}
        <a
          href="https://github.com/callacat/navigation" // *** è¯·å°† YOUR_GITHUB_REPO_URL æ›¿æ¢ä¸ºä½ çš„ GitHub ä»“åº“åœ°å€ ***
          target="_blank"
          rel="noopener noreferrer"
          className="w-8 h-8 rounded-full bg-gray-300 dark:bg-gray-700 text-gray-700 dark:text-gray-300 flex items-center justify-center text-lg hover:text-blue-600 dark:hover:text-blue-400" // æ·»åŠ æ ·å¼ä½¿å…¶æˆä¸ºåœ†å½¢æŒ‰é’®
          title="è®¿é—®æˆ‘çš„ GitHub ä»“åº“"
        >
          ğŸ™ {/* ä½¿ç”¨ Octocat å›¾æ ‡ */}
        </a>
      </div>

      {/* é¡µé¢ä¸»è¦å†…å®¹ï¼Œå‚ç›´å±…ä¸­ */}
      <div className="flex flex-col items-center">
        <h1 className="text-3xl font-bold underline text-blue-600 dark:text-blue-400">
          Hello, Navigation Site!
        </h1>

        {/* åç»­å…¶ä»–ç»„ä»¶å’Œå†…å®¹å°†æ”¾åœ¨è¿™é‡Œ */}
        {/* ä¾‹å¦‚ï¼šæ—¶é—´ã€å¤©æ°”ã€æœç´¢æ¡†ã€åˆ†åŒºç­‰ */}
      </div>

    </div>
  );
}

export default App;
